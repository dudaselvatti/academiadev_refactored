@startuml

enum SubscriptionPlan {
    BASIC
    PREMIUM
}

enum DifficultyLevel {
    BEGINNER
    INTERMEDIATE
    ADVANCED
}

enum CourseStatus {
    ACTIVE
    INACTIVE
}

abstract class User {
    # String name
    # String email
}

class Student {
    + canEnroll() : boolean
    + addEnrollment(Enrollment)
}

class Admin {
}

class Course {
    - String title
    - String description
    - int duration
    + inactivate()
    + activate()
    + isActive() : boolean
}

class Enrollment {
    - LocalDateTime date
    - int progress
    + updateProgress(int)
}

class SupportTicket {
    - int id
    - String title
    - String message
    - boolean resolved
    + closeTicket()
}

User <|-- Student
User <|-- Admin
Student --> SubscriptionPlan
Course --> DifficultyLevel
Course --> CourseStatus
Student "1" *-- "*" Enrollment
Enrollment "1" --> "1" Course
SupportTicket --> User

interface UserRepository {
    + findByEmail(String) : Optional<User>
    + save(User)
    + findAll() : List<User>
}

interface CourseRepository {
    + findByTitle(String) : Optional<Course>
    + save(Course)
    + findAll() : List<Course>
}

interface EnrollmentRepository {
    + existsByStudentAndCourse(String, String) : boolean
    + findByStudentAndCourse(String, String) : Optional<Enrollment>
    + findAllByStudentEmail(String) : List<Enrollment>
    + save(Enrollment)
    + delete(Enrollment)
}

interface TicketRepository {
    + addTicket(SupportTicket)
    + nextTicket() : Optional<SupportTicket>
    + isEmpty() : boolean
}

class UserRepositoryImpl {
    - Map<String, User> database
}

class CourseRepositoryImpl {
    - Map<String, Course> database
}

class EnrollmentRepositoryImpl {
    - List<Enrollment> database
}

class TicketRepositoryImpl {
    - Queue<SupportTicket> queue
}

UserRepositoryImpl ..|> UserRepository
CourseRepositoryImpl ..|> CourseRepository
EnrollmentRepositoryImpl ..|> EnrollmentRepository
TicketRepositoryImpl ..|> TicketRepository

class MatricularAlunoUseCase {
    + execute(email, courseTitle)
}

class ListarCursosUseCase {
    + execute() : List<Course>
}

class AbrirTicketUseCase {
    + execute(email, title, message)
}

class ProcessarTicketUseCase {
    + execute() : SupportTicket
}

class GerarRelatoriosUseCase {
    + cursosPorNivel(DifficultyLevel)
    + instrutoresComCursosAtivos()
    + alunosAgrupadosPorPlano()
    + mediaGeralProgresso()
}

class GerenciarCursoUseCase {
    + toggleStatus(courseTitle)
}

class GerenciarPlanoAlunoUseCase {
    + execute(email, newPlan)
}

class AtualizarProgressoUseCase {
    + execute(email, courseTitle, newProgress)
}

class CancelarMatriculaUseCase {
    + execute(email, courseTitle)
}

MatricularAlunoUseCase ..> UserRepository
MatricularAlunoUseCase ..> CourseRepository
MatricularAlunoUseCase ..> EnrollmentRepository
ListarCursosUseCase ..> CourseRepository
AbrirTicketUseCase ..> TicketRepository
AbrirTicketUseCase ..> UserRepository
ProcessarTicketUseCase ..> TicketRepository
GerarRelatoriosUseCase ..> CourseRepository
GerarRelatoriosUseCase ..> EnrollmentRepository
GerarRelatoriosUseCase ..> UserRepository
GerenciarCursoUseCase ..> CourseRepository
GerenciarPlanoAlunoUseCase ..> UserRepository
AtualizarProgressoUseCase ..> EnrollmentRepository
CancelarMatriculaUseCase ..> EnrollmentRepository

class GenericCsvExporter {
    + {static} export(List data, String[] columns) : String
}

class ConsoleController {
    + start()
}

class ConsoleView {
    + showMenu()
    + showMessages()
}

ConsoleController --> ConsoleView
ConsoleController --> MatricularAlunoUseCase
ConsoleController --> ListarCursosUseCase
ConsoleController --> AbrirTicketUseCase
ConsoleController --> ProcessarTicketUseCase
ConsoleController --> GerarRelatoriosUseCase
ConsoleController --> GerenciarCursoUseCase
ConsoleController --> GerenciarPlanoAlunoUseCase
ConsoleController --> AtualizarProgressoUseCase
ConsoleController --> CancelarMatriculaUseCase
ConsoleController ..> GenericCsvExporter

@enduml